<!DOCTYPE html>
<html lang="en"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="Assembly%204%20%20Buffer%20overflows%20%E2%80%93%20CS%2061_files/bootstrap.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="Assembly%204%20%20Buffer%20overflows%20%E2%80%93%20CS%2061_files/katex.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
    <link rel="stylesheet" href="Assembly%204%20%20Buffer%20overflows%20%E2%80%93%20CS%2061_files/cs161.css">
    <title>Assembly 4: Buffer overflows – CS 61</title>
  <script async="" src="Assembly%204%20%20Buffer%20overflows%20%E2%80%93%20CS%2061_files/async-ads.js"></script><script src="Assembly%204%20%20Buffer%20overflows%20%E2%80%93%20CS%2061_files/cse_element__en.js" type="text/javascript"></script><link type="text/css" rel="stylesheet" href="Assembly%204%20%20Buffer%20overflows%20%E2%80%93%20CS%2061_files/defaulten.css"><link type="text/css" rel="stylesheet" href="Assembly%204%20%20Buffer%20overflows%20%E2%80%93%20CS%2061_files/default.css"><style type="text/css">.gsc-control-cse{font-family:arial, sans-serif}.gsc-control-cse .gsc-table-result{font-family:arial, sans-serif}.gsc-refinementsGradient{background:linear-gradient(to left,rgba(255,255,255,1),rgba(255,255,255,0))}.gsc-control-cse{border-color:#FFFFFF;background-color:#FFFFFF}input.gsc-input,.gsc-input-box,.gsc-input-box-hover,.gsc-input-box-focus{border-color:#D9D9D9}.gsc-search-button-v2,.gsc-search-button-v2:hover,.gsc-search-button-v2:focus{border-color:#666666;background-color:#CECECE;background-image:none;filter:none}.gsc-search-button-v2 svg{fill:#FFFFFF}.gsc-tabHeader.gsc-tabhActive,.gsc-refinementHeader.gsc-refinementhActive{color:#CCCCCC;border-color:#CCCCCC;background-color:#FFFFFF}.gsc-tabHeader.gsc-tabhInactive,.gsc-refinementHeader.gsc-refinementhInactive{color:#CCCCCC;border-color:#CCCCCC;background-color:#FFFFFF}.gsc-webResult.gsc-result,.gsc-results .gsc-imageResult{border-color:#FFFFFF;background-color:#FFFFFF}.gsc-webResult.gsc-result:hover,.gsc-imageResult:hover{border-color:#FFFFFF;background-color:#FFFFFF}.gs-webResult.gs-result a.gs-title:link,.gs-webResult.gs-result a.gs-title:link b,.gs-imageResult a.gs-title:link,.gs-imageResult a.gs-title:link b{color:#0000CC}.gs-webResult.gs-result a.gs-title:visited,.gs-webResult.gs-result a.gs-title:visited b,.gs-imageResult a.gs-title:visited,.gs-imageResult a.gs-title:visited b{color:#0000CC}.gs-webResult.gs-result a.gs-title:hover,.gs-webResult.gs-result a.gs-title:hover b,.gs-imageResult a.gs-title:hover,.gs-imageResult a.gs-title:hover b{color:#0000CC}.gs-webResult.gs-result a.gs-title:active,.gs-webResult.gs-result a.gs-title:active b,.gs-imageResult a.gs-title:active,.gs-imageResult a.gs-title:active b{color:#0000CC}.gsc-cursor-page{color:#0000CC}a.gsc-trailing-more-results:link{color:#0000CC}.gs-webResult .gs-snippet,.gs-imageResult .gs-snippet,.gs-fileFormatType{color:#000000}.gs-webResult div.gs-visibleUrl,.gs-imageResult div.gs-visibleUrl{color:#008000}.gs-webResult div.gs-visibleUrl-short{color:#008000}.gs-webResult div.gs-visibleUrl-short{display:none}.gs-webResult div.gs-visibleUrl-long{display:block}.gs-promotion div.gs-visibleUrl-short{display:none}.gs-promotion div.gs-visibleUrl-long{display:block}.gsc-cursor-box{border-color:#FFFFFF}.gsc-results .gsc-cursor-box .gsc-cursor-page{border-color:#CCCCCC;background-color:#FFFFFF;color:#CCCCCC}.gsc-results .gsc-cursor-box .gsc-cursor-current-page{border-color:#CCCCCC;background-color:#FFFFFF;color:#CCCCCC}.gsc-webResult.gsc-result.gsc-promotion{border-color:#336699;background-color:#FFFFFF}.gsc-completion-title{color:#0000CC}.gsc-completion-snippet{color:#000000}.gs-promotion a.gs-title:link,.gs-promotion a.gs-title:link *,.gs-promotion .gs-snippet a:link{color:#0000CC}.gs-promotion a.gs-title:visited,.gs-promotion a.gs-title:visited *,.gs-promotion .gs-snippet a:visited{color:#0000CC}.gs-promotion a.gs-title:hover,.gs-promotion a.gs-title:hover *,.gs-promotion .gs-snippet a:hover{color:#0000CC}.gs-promotion a.gs-title:active,.gs-promotion a.gs-title:active *,.gs-promotion .gs-snippet a:active{color:#0000CC}.gs-promotion .gs-snippet,.gs-promotion .gs-title .gs-promotion-title-right,.gs-promotion .gs-title .gs-promotion-title-right *{color:#000000}.gs-promotion .gs-visibleUrl,.gs-promotion .gs-visibleUrl-short{color:#008000}.gcsc-find-more-on-google{color:#0000CC}.gcsc-find-more-on-google-magnifier{fill:#0000CC}</style><style type="text/css">.gscb_a{display:inline-block;font:27px/13px arial,sans-serif}.gsst_a .gscb_a{color:#a1b9ed;cursor:pointer}.gsst_a:hover .gscb_a,.gsst_a:focus .gscb_a{color:#36c}.gsst_a{display:inline-block}.gsst_a{cursor:pointer;padding:0 4px}.gsst_a:hover{text-decoration:none!important}.gsst_b{font-size:16px;padding:0 2px;position:relative;user-select:none;-moz-user-select:none;white-space:nowrap}.gsst_e{vertical-align:middle;opacity:0.55;}.gsst_a:hover .gsst_e,.gsst_a:focus .gsst_e{opacity:0.72;}.gsst_a:active .gsst_e{opacity:1;}.gsst_f{background:white;text-align:left}.gsst_g{background-color:white;border:1px solid #ccc;border-top-color:#d9d9d9;box-shadow:0 2px 4px rgba(0,0,0,0.2);-moz-box-shadow:0 2px 4px rgba(0,0,0,0.2);margin:-1px -3px;padding:0 6px}.gsst_h{background-color:white;height:1px;margin-bottom:-1px;position:relative;top:-1px}.gsib_a{width:100%;padding:4px 6px 0}.gsib_a,.gsib_b{vertical-align:top}.gssb_c{border:0;position:absolute;z-index:989}.gssb_e{border:1px solid #ccc;border-top-color:#d9d9d9;box-shadow:0 2px 4px rgba(0,0,0,0.2);-moz-box-shadow:0 2px 4px rgba(0,0,0,0.2);cursor:default}.gssb_f{visibility:hidden;white-space:nowrap}.gssb_k{border:0;display:block;position:absolute;top:0;z-index:988}.gsdd_a{border:none!important}.gsq_a{padding:0}.gssb_a{padding:0 7px}.gssb_a,.gssb_a td{white-space:nowrap;overflow:hidden;line-height:22px}#gssb_b{font-size:11px;color:#36c;text-decoration:none}#gssb_b:hover{font-size:11px;color:#36c;text-decoration:underline}.gssb_g{text-align:center;padding:8px 0 7px;position:relative}.gssb_h{font-size:15px;height:28px;margin:0.2em}.gssb_i{background:#eee}.gss_ifl{visibility:hidden;padding-left:5px}.gssb_i .gss_ifl{visibility:visible}a.gssb_j{font-size:13px;color:#36c;text-decoration:none;line-height:100%}a.gssb_j:hover{text-decoration:underline}.gssb_l{height:1px;background-color:#e5e5e5}.gssb_m{color:#000;background:#fff}.gssb_a{padding:0 9px}.gsib_a{padding:5px 9px 4px 9px}.gscb_a{line-height:27px}.gssb_e{border:0}.gssb_l{margin:5px 0}input.gsc-input::-webkit-input-placeholder{font-size:14px}input.gsc-input:-moz-placeholder{font-size:14px}input.gsc-input::-moz-placeholder{font-size:14px}input.gsc-input:-ms-input-placeholder{font-size:14px}input.gsc-input:focus::-webkit-input-placeholder{color:transparent}input.gsc-input:focus:-moz-placeholder{color:transparent}input.gsc-input:focus::-moz-placeholder{color:transparent}input.gsc-input:focus:-ms-input-placeholder{color:transparent}.gssb_c .gsc-completion-container{position:static}.gssb_c{z-index:5000}.gsc-completion-container table{background:transparent;font-size:inherit;font-family:inherit}.gssb_c > tbody > tr,.gssb_c > tbody > tr > td,.gssb_d,.gssb_d > tbody > tr,.gssb_d > tbody > tr > td,.gssb_e,.gssb_e > tbody > tr,.gssb_e > tbody > tr > td{padding:0;margin:0;border:0}.gssb_a table,.gssb_a table tr,.gssb_a table tr td{padding:0;margin:0;border:0}</style></head>
  <body>

<nav class="navbar navbar-expand-lg navbar-light">
  <a class="navbar-brand" href="https://cs61.seas.harvard.edu/site/2018/">CS 61 2018</a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav mr-auto">
      <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" href="#" id="nav-dropdown-info" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      Info
    </a>
    <div class="dropdown-menu" aria-labelledby="nav-dropdown-info">
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/Concepts/">Concepts</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/CourseDescription/">Course Description</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/Staff/">Course Staff</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/Extension/">Extension</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/ZoomOH/">Extension School Zoom Office Hours</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/Prerequisites/">Prerequisites</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/Resources/">Resources</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/Schedule/">Schedule</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/Style/">Style</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/Textbook/">Textbook</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/Infrastructure/">Infrastructure</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/DatarepEx/">Exercises: Data representation</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/AsmEx/">Exercises: Assembly</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/KernelEx/">Exercises: Kernel</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/StorageEx/">Exercises: Storage</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/ShellEx/">Exercises: Process control</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/SynchEx/">Exercises: Synchronization</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/MiscEx/">Exercises: Miscellaneous</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/Patterns/">C and C++ Patterns</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/ref/diff/">Diff</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/ref/file-descriptors/">File Descriptors</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/ref/gdb-commands/">GDB Commands</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/ref/gdb/">GDB Introduction</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/ref/git/">Git</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/ref/http/">HTTP</a>
    
    </div>
  </li>
      <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" href="#" id="nav-dropdown-psets" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      Problem sets
    </a>
    <div class="dropdown-menu" aria-labelledby="nav-dropdown-psets">
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/Dmalloc/">Problem set 1</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/BinaryBomb/">Problem set 2</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/Stdio/">Problem set 3</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/WeensyOS/">Problem set 4</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/Shell/">Problem set 5</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/Pong/">Problem set 6</a>
    
    </div>
  </li>
      <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" href="#" id="nav-dropdown-lectures" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      Lectures
    </a>
    <div class="dropdown-menu" aria-labelledby="nav-dropdown-lectures">
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/Datarep2/">Data representation 2: Object representation</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/Datarep3/">Data representation 3: Layout</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/Datarep4/">Data representation 4: Pointers and undefined behavior</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/Datarep5/">Data representation 5: Undefined behavior, bitwise operations, arena allocation</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/Datarep6/">Data representation 6: Arena allocation</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/Asm1/">Assembly 1: Basics</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/Asm2/">Assembly 2: Calling convention</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/Asm3/">Assembly 3: Optimizations and assembly</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/Asm4/">Assembly 4: Buffer overflows</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/Storage1/">Storage 1: Caches</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/Storage2/">Storage 2: Cache model</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/Storage3/">Storage 3: Stdio cache</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/Storage4/">Storage 4: Consistency</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/Kernel1/">Kernel 1: Robustness and safety</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/Kernel2/">Kernel 2: Process isolation and virtual memory</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/Kernel3/">Kernel 3: x86-64 page tables and WeensyOS</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/Kernel4/">Kernel 4: Protection and isolation</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/Kernel5/">Kernel 5: Confused deputy attack, scheduling, and process management</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/Shell1/">Shell 1: Process control</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/Shell2/">Shell 2: Process creation and interprocess communication</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/Shell3/">Shell 3: Sieve of Eratosthenes, polling vs. blocking</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/Synch1/">Synchronization 1: Signals, race condition, threads</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/Synch2/">Synchronization 2: Mutex, bounded buffers</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/Synch3/">Synchronization 3: Mutexes, condition variables, and compare-exchange</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/Synch4/">Synchronization 4: Networking and Synchronization</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/Synch5/">Synchronization 5: Deadlock and Server Programming</a>
    
    </div>
  </li>
      <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" href="#" id="nav-dropdown-sections" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      Sections
    </a>
    <div class="dropdown-menu" aria-labelledby="nav-dropdown-sections">
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/Section1/">Section 1</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/Section2/">Section 2</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/Section3/">Section 3</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/Section4/">Section 4</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/Section5/">Section 5</a>
    
      <a class="dropdown-item" href="https://cs61.seas.harvard.edu/site/2018/Section6/">Section 6</a>
    
    </div>
  </li>
      
  <li class="nav-item">
    
      <a class="nav-link" href="https://cs61.seas.harvard.edu/site/2018/Schedule/">Schedule</a>
    
  </li>
      <li class="nav-item"><script type="text/javascript" async="" src="Assembly%204%20%20Buffer%20overflows%20%E2%80%93%20CS%2061_files/cse.js"></script><script>
  (function() {
    var cx ='001870065194094800801:cru2ukzhywq';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script><div id="___gcse_0"><div class="gsc-control-cse gsc-control-cse-en"><div class="gsc-control-wrapper-cse" dir="ltr"><form class="gsc-search-box gsc-search-box-tools" accept-charset="utf-8"><table class="gsc-search-box" cellspacing="0" cellpadding="0"><tbody><tr><td class="gsc-input"><div class="gsc-input-box" id="gsc-iw-id1"><table style="width: 100%; padding: 0px;" id="gs_id50" class="gstl_50 gsc-input" cellspacing="0" cellpadding="0"><tbody><tr><td id="gs_tti50" class="gsib_a"><input autocomplete="off" type="text" size="10" class="gsc-input" name="search" title="search" style="width: 100%; padding: 0px; border: medium none; margin: 0px; height: auto; outline: currentcolor none medium;" id="gsc-i-id1" dir="ltr" spellcheck="false"></td><td class="gsib_b"><div class="gsst_b" id="gs_st50" dir="ltr"><a class="gsst_a" href="javascript:void(0)" style="display: none;" title="Clear search box" role="button"><span class="gscb_a" id="gs_cb50" aria-hidden="true">×</span></a></div></td></tr></tbody></table></div></td><td class="gsc-search-button"><button class="gsc-search-button gsc-search-button-v2"><svg width="13" height="13" viewBox="0 0 13 13"><title>search</title><path d="m4.8495 7.8226c0.82666 0 1.5262-0.29146 2.0985-0.87438 0.57232-0.58292 0.86378-1.2877 0.87438-2.1144 0.010599-0.82666-0.28086-1.5262-0.87438-2.0985-0.59352-0.57232-1.293-0.86378-2.0985-0.87438-0.8055-0.010599-1.5103 0.28086-2.1144 0.87438-0.60414 0.59352-0.8956 1.293-0.87438 2.0985 0.021197 0.8055 0.31266 1.5103 0.87438 2.1144 0.56172 0.60414 1.2665 0.8956 2.1144 0.87438zm4.4695 0.2115 3.681 3.6819-1.259 1.284-3.6817-3.7 0.0019784-0.69479-0.090043-0.098846c-0.87973 0.76087-1.92 1.1413-3.1207 1.1413-1.3553 0-2.5025-0.46363-3.4417-1.3909s-1.4088-2.0686-1.4088-3.4239c0-1.3553 0.4696-2.4966 1.4088-3.4239 0.9392-0.92727 2.0864-1.3969 3.4417-1.4088 1.3553-0.011889 2.4906 0.45771 3.406 1.4088 0.9154 0.95107 1.379 2.0924 1.3909 3.4239 0 1.2126-0.38043 2.2588-1.1413 3.1385l0.098834 0.090049z"></path></svg></button></td><td class="gsc-clear-button"><div class="gsc-clear-button" title="clear results">&nbsp;</div></td></tr></tbody></table></form><div class="gsc-results-wrapper-overlay"><div class="gsc-results-close-btn" tabindex="0"></div><div class="gsc-positioningWrapper"><div class="gsc-tabsAreaInvisible"><div aria-label="refinement" role="tab" class="gsc-tabHeader gsc-inline-block gsc-tabhActive">Custom Search</div><span class="gs-spacer"> </span></div></div><div class="gsc-positioningWrapper"><div class="gsc-tabsAreaInvisible"></div></div><div class="gsc-above-wrapper-area-invisible"><table class="gsc-above-wrapper-area-container" cellspacing="0" cellpadding="0"><tbody><tr><td class="gsc-result-info-container"><div class="gsc-result-info-invisible"></div></td><td class="gsc-orderby-container"><div class="gsc-orderby-invisible"><div class="gsc-orderby-label gsc-inline-block">Sort by:</div><div class="gsc-option-menu-container gsc-inline-block"><div class="gsc-selected-option-container gsc-inline-block"><div class="gsc-selected-option">Relevance</div><div class="gsc-option-selector"></div></div><div class="gsc-option-menu-invisible"><div class="gsc-option-menu-item gsc-option-menu-item-highlighted"><div class="gsc-option">Relevance</div></div><div class="gsc-option-menu-item"><div class="gsc-option">Date</div></div></div></div></div></td></tr></tbody></table></div><div class="gsc-adBlockInvisible"></div><div class="gsc-wrapper"><div class="gsc-adBlockInvisible"></div><div class="gsc-resultsbox-invisible"><div class="gsc-resultsRoot gsc-tabData gsc-tabdActive"><div><div class="gsc-expansionArea"></div></div></div></div></div></div><div class="gsc-modal-background-image" tabindex="0"></div></div></div></div></li>
    </ul>
  </div>
</nav>


<img src="Assembly%204%20%20Buffer%20overflows%20%E2%80%93%20CS%2061_files/cs61hello.jpg" class="hellobackground">


<div class="container">
    <h1><a href="https://cs61.seas.harvard.edu/site/2018/Asm4/">Assembly 4: Buffer overflows</a></h1>
    <div class="post">
        <p>The <code>storage1/attackme.cc</code> file contains a particularly dangerous kind of
undefined behavior, a <a href="https://en.wikipedia.org/wiki/Buffer_overflow"><strong>buffer
overflow</strong></a>. In a buffer
overflow, an untrusted input is transferred into a <em>buffer</em>, such as an array
of characters on the stack, without checking to see whether the buffer is big
enough for the untrusted input.</p>

<p>Historically buffer overflows have caused some of the worst, and most
consequential, C and C++ security holes known. They are particularly bad when
the untrusted input derives from the network: then breaking into a network can
be as simple as sending a packet.</p>

<p>The buffer overflow in <code>attackme.cc</code> derives from a <a href="#checksums"><strong>checksum function</strong></a>.
Our simple
<code>checksum</code> takes in a pointer to the buffer, then copies that buffer to a
local variable, <code>buf</code>, and processes the copy. Unfortunately, <code>checksum</code>
doesn’t verify that the input fits its buffer, and if the user supplies too
big an argument, <code>checksum</code>’s buffer will overflow!</p>

<p>Buffer overflows cause undefined behavior—it’s illegal to access memory
outside any object. Undefined behavior is always bad, but some is worse than
others; and this particular buffer overflow allows the attacker to completely
own the victim program, causing it to execute <em>any shell command</em>!</p>

<p>The attack works as follows.</p>

<ul>
<li><p>The function’s entry sequence allocates local variable space with <code>subq
$112, %rsp</code>. Examining the assembly we can infer that <code>buf</code> is stored at
this <code>%rsp</code>.</p></li>

<li><p>The function’s return address is stored at <code>112(%rsp)</code>, which is <code>buf.c +
112</code>.</p></li>

<li><p>Any input <code>arg</code> with <code>strlen(arg) &gt; 99</code> will overflow the buffer. (The 100th
character is the null character that ends the string). But <code>arg</code>s with 100
to 111 characters won’t cause problems, because the remaining 12 bytes of
local variable space are unused (they’re present to ensure stack frame
alignment).</p></li>

<li><p><code>arg</code>s of 112 or more characters, however, will run into the stack slot
reserved for <code>checksum</code>’s return address! An attacker can put any value they
want in that location, as long as the value contains no null characters
(since <code>checksum</code>’s buffer copy stops when it encounters the end of the
input string).</p></li>

<li><p>Overflowing the return address slot causes harm when <code>checksum</code> returns.
Examining the state during the exit sequence, we see that the immediately
previous instructions load <code>%rdi</code> with <code>buf</code> and call <code>finish_checksum</code>. But
what a coincidence—<code>finish_checksum</code> does not modify <code>%rdi</code>! Thus, when
<code>checksum</code> returns, <code>%rdi</code> will be loaded with the address of <code>buf</code>.</p></li>

<li><p>Our attacker therefore supplies a carefully-chosen string that overwrites
<code>checksum</code>’s return address with <em>the address of the <code>run_shell</code> function</em>.
This will cause <code>run_shell</code> to run the programs defined in the initial
portion of the string!</p></li>
</ul>

<p>Thus, the attacker has taken control of the victim by <strong>returning</strong> to an
unexpected library function, with carefully-chosen arguments. This attack is
called a <strong>return-to-libc attack</strong>.</p>

<blockquote class="note">
<p>A version of <code>checksum</code>’s copy-to-aligned-buffer technique is actually
useful in practice, but real code would use a smaller buffer, processed one
slice at a time.</p>
</blockquote>

<h2 id="defending-against-returntolibc-attacks-and-buffer-overflows">Defending against return-to-libc attacks and buffer overflows</h2>

<p>Return-to-libc attacks used to be pretty trivial to find and execute, but
recent years have seen large improvements in the robustness of typical C and
C++ programs to attack. Here are just a few of the defenses we had to disable
for the simple <code>attackme</code> attack to work.</p>

<p><strong>Register arguments</strong>: In older architectures, function arguments were <em>all</em>
passed on the stack. In those architectures attackers could easily determine
not only the <em>function</em> returned to, but also <em>its arguments</em> (a longer buffer
overflow would overwrite the stack region interpreted by the “return-callee”
as arguments). <code>attackme</code> only works because <code>finish_checksum</code> happens not to
modify its argument.</p>

<p>Modern operating systems and architectures support <strong>position-independent
code</strong> and <strong>position-independent executables</strong>. These features make programs
work independent of specific addresses for functions, and the operating system
can put a program’s functions at different addresses each time the program
runs. When a program is position-independent, the address of the attacker’s
desired target function can’t be predicted, so the attacker has to get lucky.
(The x86-64 designers were smart to add <code>%rip</code>-relative addressing, since
that’s what enables efficient position-independent executables!)</p>

<p>Finally, modern compilers use a technique called <strong>stack protection</strong> or
<a href="https://en.wikipedia.org/wiki/Stack_buffer_overflow"><strong>stack canaries</strong></a> to
detect buffer overflows and stop <code>retq</code> from returning to a corrupted address.
This is a super useful technique.</p>

<blockquote class="note">
<p>It’s called a “canary” in reference to the phrase <a href="https://en.wiktionary.org/wiki/canary_in_a_coal_mine">“canary in a coal mine”</a>.</p>
</blockquote>

<ol>
<li><p>The operating system reserves a special tiny memory segment when the
program starts running. This tiny memory segment is used for special
purposes, such as <a href="https://en.wikipedia.org/wiki/Thread-local_storage"><strong>thread-local
storage</strong></a>. Although
this segment can be addressed normally—it exists in memory—the operating
system also ensures it can be accessed through special instruction formats
like this:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-asm" data-lang="asm"><span style="color:#06287e">movq</span> <span style="color:#bb60d5">%fs</span>:<span style="color:#40a070">0x28</span>, <span style="color:#bb60d5">%rax</span></code></pre></div>
<p>The <code>%fs:</code> prefix tells the processor that <code>0x28</code> (a memory offset) is to
be measured relative to the start of the thread-local storage segment.</p></li>

<li><p>A specific memory word in thread-local storage is reserved for a canary
value. The operating system sets this value to a random word when starting
the program.</p></li>

<li><p>The compiler adds code to function entry and exit sequences that use this
value. Specifically, something like this is added to entry:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-asm" data-lang="asm"><span style="color:#06287e">movq</span> <span style="color:#bb60d5">%fs</span>:<span style="color:#40a070">0x28</span>, <span style="color:#60add5">REG</span>    <span style="color:#60a0b0;font-style:italic"># load true canary to register
</span><span style="color:#60a0b0;font-style:italic"></span><span style="color:#60add5">pushq</span> <span style="color:#60add5">REG</span>             <span style="">#</span> <span style="color:#60add5">push</span> <span style="color:#60add5">canary</span> <span style="color:#60add5">to</span> <span style="color:#60add5">stack</span></code></pre></div>
<p>And something like this is added to exit:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-asm" data-lang="asm"><span style="color:#06287e">popq</span> <span style="color:#60add5">REG</span>              <span style="color:#60a0b0;font-style:italic"># pop canary from stack
</span><span style="color:#60a0b0;font-style:italic"></span><span style="color:#60add5">xorq</span> <span style="color:#bb60d5">%fs</span>:<span style="color:#40a070">0x28</span>, <span style="color:#60add5">REG</span>    <span style="color:#60a0b0;font-style:italic"># xor with true canary
</span><span style="color:#60a0b0;font-style:italic"></span><span style="color:#60add5">jne</span> <span style="color:#60add5">fail</span>              <span style="">#</span> <span style="color:#60add5">fail</span> <span style="color:#60add5">if</span> <span style="color:#60add5">they</span> <span style="color:#60add5">differ</span></code></pre></div>
<p>where the <code>fail</code> branch calls a library-provided function such as
 <code>__stack_chk_fail</code>.</p></li>
</ol>

<p>The pushed canary is located between the function’s buffers (its local
variables) and the function’s return address. Given that position, any buffer
overflow that reaches the return address will also overwrite the canary! And
the attacker can’t easily guess the canary or overwrite the true canary’s
memory location, since both are random.</p>

<p>If the stack canary and the true canary don’t match, the function can infer
that it executed some undefined behavior. Maybe the return address was
corrupted and maybe it wasn’t; either way, executing undefined behavior means
the program is broken, and it is safe to exit immediately.</p>

<p>These techniques, and others like them, are incredibly useful, important, fun,
and good to understand. But they don’t make C programming safe: attackers are
persistent and creative. (Check out <a href="https://en.wikipedia.org/wiki/Return-oriented_programming">return-oriented
programming</a>.)
Memory-unsafe languages like C and C++ make programming inherently risky; only
programs with no undefined behavior are safe. (And they’re only safe if the
underlying libraries and operating system have no undefined behavior either!)
Good C and C++ programmers need a healthy respect for—one might say fear
of—their tools. Code cleanly, use standard libraries where possible, and test
extensively under sanitizers to catch bugs like buffer overflows.</p>

<p>Or listen to cranky people like Trevor Jim, who says that <a href="http://trevorjim.com/c-is-bad-and-you-should-feel-bad-if-you-dont-say-it-is-bad/">“C is bad and you
should feel bad if you don’t say it is
bad”</a>
and also <a href="http://trevorjim.com/legacy-c-c++-code-is-a-nuclear-waste-nightmare-that-will-make-you-wannacry/">“Legacy C/C++ code is a nuclear waste nightmare that will make you
WannaCry”</a>.</p>

<h2 id="checksums">On checksums</h2>

<p>A <strong>checksum</strong> is a
short, usually fixed-length summary of a data buffer. Checksums have two
important properties:</p>

<ol>
<li>If two buffers contain the same data (the same bytes in the same order),
then their checksums <strong>must</strong> equal. (This property is mandatory.)</li>
<li>If two buffers contain <em>different</em> data, then their checksums <strong>should
not</strong> be equal. (This property is optional: it is OK for distinct data to
have equal checksums, though in a good checksum function, this should be
rare.)</li>
</ol>

<p>Checksums have many uses, but they are often used to detect errors in data
transcription. For example, most network technologies use checksums to detect
link errors (like bursts of noise). To send data over a network, the sender
first computes a checksum of the data. Then it transmits both data and
checksum over the possibly-noisy network channel. The receiver computes its
own checksum of the received data, and compares that with the sender’s
checksum. If the checksums match, that’s a good sign that the data was
transmitted correctly. If the checksums don’t match, then the data can’t be
trusted and the receiver throws it away.</p>

<p>Most checksum functions map from a large domain to a smaller range—for
instance, from the set of all variable-length buffers to the set of 64-bit
numbers. Such functions <em>must</em> sometimes map unequal data to equal checksums,
so some errors must go undetected; but a good checksum function detects common
corruption errors all, or almost all, the time. For example, some checksum
functions can <em>always</em> detect a single flipped bit in the buffer.</p>

<p>The requirements on checksums are the same as the requirements for <a href="https://en.wikipedia.org/wiki/Hash_function">hash
codes</a>: equal buffers have equal
checksums (hash codes), and distinct buffers should have distinct checksums
(hash codes). A good hash code can be a good checksum and vice versa.</p>

<p>The most important characteristics of a checksum function are speed and
strength. Fast checksums are inexpensive to compute, but easy to break,
meaning that many errors in the data aren’t detected by the checksum function.
Widely-used fast checksum functions include <a href="https://en.wikipedia.org/wiki/IPv4_header_checksum">the IPv4/TCP/UDP
checksum</a> and <a href="https://en.wikipedia.org/wiki/Cyclic_redundancy_check">cyclic
redundancy checks</a>; our
<code>checksum</code> function is a lot like the IPv4 checksum. Strong checksums, also
known as <a href="https://en.wikipedia.org/wiki/Cryptographic_hash_function">cryptographic hash
functions</a>, are
hard to break. Ideally they are <em>infeasible</em> to break, meaning that no one
knows a procedure for finding two buffers that have the same checksum.
Widely-used strong checksum functions include <a href="https://en.wikipedia.org/wiki/SHA-2">SHA-256,
SHA-512</a>, and
<a href="https://en.wikipedia.org/wiki/SHA-3">SHA-3</a>. There are also many
formerly-strong checksum functions, such as
<a href="https://en.wikipedia.org/wiki/SHA-1">SHA-1</a>, that have been broken—meaning
that procedures are known for finding two buffers with the same checksum—but
are still stronger in practice than fast checksums.</p>

<p>References: <a href="https://en.wikipedia.org/wiki/Checksum">Checksums on Wikipedia</a>;
<a href="https://people.seas.harvard.edu/~salil/cs225/">CS&nbsp;225</a> explores some related
theory.</p>

    </div>
</div>

        <script src="Assembly%204%20%20Buffer%20overflows%20%E2%80%93%20CS%2061_files/jquery-3.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
        <script src="Assembly%204%20%20Buffer%20overflows%20%E2%80%93%20CS%2061_files/popper.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
        <script src="Assembly%204%20%20Buffer%20overflows%20%E2%80%93%20CS%2061_files/bootstrap.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
        <script src="Assembly%204%20%20Buffer%20overflows%20%E2%80%93%20CS%2061_files/katex.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
        <script>(function () {
        jQuery.fn.extend({
            geometry: function (outer) {
                var x;
                if (this[0] == window)
                    x = {left: this.scrollLeft(), top: this.scrollTop()};
                else
                    x = this.offset();
                if (x) {
                    x.width = outer ? this.outerWidth() : this.width();
                    x.height = outer ? this.outerHeight() : this.height();
                    x.right = x.left + x.width;
                    x.bottom = x.top + x.height;
                }
                return x;
            }
        });
        $(".math").each(function () {
            var t = this.innerText,
                opt = {throwOnError: false, displayMode: t.substr(0, 2) === "\\["};
            katex.render(t.replace(/(?:^\\\(|^\\\[|\\\)$|\\\]$)/g, ""), this, opt);
        });
        function sol_toggle(hide, storage) {
            this.childNodes[0].classList.toggle("hidden", !hide);
            this.childNodes[0].classList.toggle("shown", hide);
            this.childNodes[1].classList.toggle("hidden", hide);
            this.childNodes[1].classList.toggle("shown", !hide);
            if (storage) {
                var key = location.href + " " + $(".has-solution").index(this);
                if (hide)
                    sessionStorage.removeItem(key);
                else
                    sessionStorage.setItem(key, true);
            }
        }
        $(".solution").each(function () {
            $(this).wrap('<div class="has-solution"></div>');
            var sol = this.parentElement;
            $(sol).prepend('<blockquote class="solution-collapsed js-solution show"><a href="" class="js-solution show"></a></blockquote>');
            $(this).append('<p><a href="" class="js-solution hide"></a></p>');
            $(sol).find("a.js-solution.show").text(this.getAttribute("data-show-text") || "Show solution");
            $(sol).find("a.js-solution.hide").text(this.getAttribute("data-hide-text") || "Hide solution");
            var key = location.href + " " + $(".has-solution").index(sol);
            if (sessionStorage.getItem(key))
                sol_toggle.call(sol, false, false);
        });
        $(document).on("click", ".js-solution", function (event) {
            if (this.classList.contains("all")) {
                var hide = this.classList.contains("hide");
                $(".has-solution").each(function () {
                    sol_toggle.call(this, hide, false);
                });
                var bq = this.tagName === "BLOCKQUOTE" ? this : this.parentElement;
                $(bq).find(".show").toggleClass("hidden", !hide);
                $(bq).find(".hide").toggleClass("hidden", hide);
            } else {
                var sol = $(this).closest(".has-solution")[0];
                sol_toggle.call(sol, this.classList.contains("hide"), true);
            }
            event.preventDefault();
            event.stopPropagation();
        });
        var container = $(".container")[0];
        function slideview_toggle(hide, storage) {
            if (hide === null)
                hide = container.classList.contains("container-slides");
            container.classList.toggle("container-slides", !hide);
            if (storage) {
                var key = location.href + " slides";
                if (hide)
                    sessionStorage.removeItem(key);
                else
                    sessionStorage.setItem(key, true);
            }
        }
        function slideview_setpos(pos) {
            var slidecount = +this.getAttribute("data-reveal-steps");
            var es = [this], n = this.nextSibling;
            while (n && n.tagName !== "H2") {
                es.push(n);
                n = n.nextSibling;
            }
            $(es).find("[data-reveal]").add($(es).filter("[data-reveal]")).each(function () {
                $(this).toggleClass("hidden", +this.getAttribute("data-reveal") > pos);
            });
            this.setAttribute("data-reveal-pos", pos);
        }
        function slideview_keypress(event) {
            if (event.altKey || event.ctrlKey || event.metaKey || event.shiftKey
                || (event.keyCode != 37 && event.keyCode != 39)
                || !container.classList.contains("container-slides"))
                return;
            var isleft = event.keyCode == 37, space = 20, slop = space + 5;
            var w = $(window).geometry(), divs = $("h2"), i;
            for (i = isleft ? divs.length - 1 : 0;
                 i >= 0 && i < divs.length;
                 i += (isleft ? -1 : 1)) {
                var d = divs[i], g = $(d).geometry();
                if (g.top - slop < w.top
                    && g.top + slop > w.top
                    && d.hasAttribute("data-reveal-steps")) {
                    var slidecount = +d.getAttribute("data-reveal-steps");
                    var slidepos = +d.getAttribute("data-reveal-pos") + (isleft ? -1 : 1);
                    if (isleft ? slidepos >= 0 : slidepos < slidecount) {
                        slideview_setpos.call(d, slidepos);
                        break;
                    }
                }
                if (isleft ? g.top + slop < w.top : g.top > w.top + slop) {
                    $(window).scrollTop(g.top - space);
                    if (d.hasAttribute("data-reveal-steps")) {
                        slideview_setpos.call(d, isleft ? +d.getAttribute("data-reveal-steps") - 1 : 0);
                    }
                    break;
                }
            }
            if (i < 0)
                $(window).scrollTop(0);
            event.preventDefault();
        }
        $(document).on("click", ".js-toggle-slideview", function (event) {
            slideview_toggle(null, true);
            event.preventDefault();
            event.stopPropagation();
        });
        $(".need-container-slides").each(function () {
            $(this).prepend('<blockquote class="slideview-toggle"><a href="" class="js-toggle-slideview">Toggle slide view</a></blockquote>').removeClass("need-container-slides");
            var key = location.href + " slides";
            if (sessionStorage.getItem(key))
                slideview_toggle(false, false);
            $("body").on("keyup", slideview_keypress);
        });
        })()</script>
    


<table style="width: 184px; display: none; top: 45px; left: 603px; position: absolute;" class="gstl_50 gssb_c" cellspacing="0" cellpadding="0"><tbody><tr><td class="gssb_f"></td><td class="gssb_e" style="width: 100%;"></td></tr></tbody></table></body></html>